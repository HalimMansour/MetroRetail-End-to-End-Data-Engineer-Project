

/*
    Gold Model: Store Dimension
    Source: Silver.erp_stores_clean
    Target: Gold.dim_store

    Provides store master for fact_sales joins
    
    Business Rules:
    - Store_Key is surrogate key (auto-generated)
    - Store_ID is natural key
    - One row per store
*/

WITH source AS (
    SELECT *
    FROM "MetroRetailDB"."Silver"."erp_stores_clean"
    WHERE Is_Valid = 1
),

final AS (
    SELECT
        -- Store_Key will be auto-generated by SQL Server IDENTITY
        Store_ID,
        Store_Name,
        City,
        Region,
        Store_Manager,
        Store_Area_sqm,
        Open_Date,
        
        -- Metadata
        DQ_Score,
        GETDATE() AS Created_TS,
        GETDATE() AS Updated_TS
        
    FROM source
)

SELECT * FROM final

/*
    Output Schema:
    - Store_Key: INT - Surrogate key (auto-generated)
    - Store_ID: VARCHAR(50) - Natural key
    - Store_Name: VARCHAR(255)
    - City: VARCHAR(100)
    - Region: VARCHAR(100)
    - Store_Manager: VARCHAR(255)
    - Store_Area_sqm: DECIMAL(10,2)
    - Open_Date: DATE
    - DQ_Score: INT
    - Created_TS: DATETIME2
    - Updated_TS: DATETIME2
    
    Note: Store_Age_Years is computed column in SQL Server
*/